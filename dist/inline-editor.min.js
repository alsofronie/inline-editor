/*! Inline Editor - v0.1.0 -  * 2015-08-13
 * * https://github.com/alsofronie/inline-editor
 * Copyright (c) 2015 Alex Sofronie; * Licensed MIT */ 
!function(a,b,c){"use strict";function d(a,b){var c;for(c in b)a.hasOwnProperty(c)&&("object"==typeof b[c]?a[c]=d(a[c],b[c]):a[c]=b[c]);return a}function e(a,b,c){a.setAttribute(b,c)}function f(a,b){return a&&null!==a&&a!==c?(b=b.toLowerCase(),b===a.tagName.toLowerCase()?!0:!1):!1}function g(b,c){b=b||a.event,b.stopPropagation&&b.stopPropagation(),b.cancelBubble=!0,c===!0&&b.preventDefault()}function h(a){var b,c=null,d=null;for(window.getSelection?(b=window.getSelection(),b.rangeCount&&(c=b.getRangeAt(0).commonAncestorContainer,1!==c.nodeType&&(c=c.parentNode))):(b=document.selection)&&"Control"!==b.type&&(c=b.createRange().parentElement()),d=c;d&&d.nodeName&&"section"!==d.nodeName.toLowerCase();)d=d.parentNode;a.sel=c,a.sec=d}function i(a){var b=a.sel;console.info("Verify empty on parent",b);var c=b;console.info("We need to check the node ",c),f(c,"figure")&&(c=c.lastChild);var d=c.innerHTML.trim().toLowerCase();console.info("html is ",d),("<br>"===d||"<br/>"===d||"<br />"===d||"&nbsp;"===d||""===d)&&(c.innerHTML=null,c.className="")}function j(a,b,d,e){if(null===b.current){var f=document.createElement("div");f.id=d;var h=document.createElement("ul");f.appendChild(h);var i=b.widgets;for(var j in e){var k=e[j];if("|"!==k)if(i[k]){var l=i[k](!1),m=document.createElement("li"),n=document.createElement("button");if(n.dataset.act=k,console.info("W is ",n),n.onclick=function(b){g(b),console.info("event target is ",b.srcElement);var c=b.srcElement||b.target,d=c.dataset.act;console.info("Calling on ",d),i[k].call(a,!0)},l.icon!==c){var o=document.createElement("i");o.className="icon icon-"+l.icon,n.appendChild(n)}else l.text!==c&&n.appendChild(document.createTextNode(l.text));m.appendChild(n),h.appendChild(m)}else console.error("We do not know how to handle ",k);else{var p=document.createElement("li");p.className="divider",h.appendChild(p)}}document.body.appendChild(f),b.current=f}b.current.className="";var q=window.getSelection(),r=q.getRangeAt(0).cloneRange(),s=r.getClientRects()[0],t={width:q.offsetWidth,height:q.offsetHeight};return b.current.style.left=s.left-Math.floor(t.width/2)+Math.floor(s.width/2)+"px",b.current.style.top=s.top-3-t.height+"px",b.current}var k={lang:{text:"Add your text here",title:"Add your title here"},toolboxes:{selection:["bold","italic","underline","strikethrough","|","h","p","|","align"],insert:["image","video","embed","section"],image:["normal","left","right","full"]}},l={selection:{current:null,widgets:{bold:function(a){return a?void document.execCommand("bold",!1,!0):{icon:"bold"}},italic:function(a){return a?void document.execCommand("italic",!1,!0):{icon:"bold"}},underline:function(a){return a?void document.execCommand("underline",!1,!0):{icon:"underline"}},strikethrough:function(a){return a?void document.execCommand("strikeThrough",!1,!0):{icon:"strike"}},align:function(a){return a?void console.info("We run align in context ",a):{icon:"align"}},p:function(a){return a?void console.info("We need to change the current parent element to a paragraph"):{icon:"para"}},h:function(a){return a?void console.info("We need to change the current parent elment to a heading"):{icon:"heading"}}}}};a.InlineEditor=function(){function b(b){b=b?b:a.event,h(m),console.info("Parent element: ",m.sel),console.info("Section element: ",m.sec)}function c(b){if(b=b?b:a.event,h(m),13===b.keyCode)if(g(b,!0),b.shiftKey===!0){var c,d,e;window.getSelection?(c=window.getSelection(),c.getRangeAt&&c.rangeCount&&(d=c.getRangeAt(0),d.deleteContents(),d.collapse(!1),e=document.createElement("br"),d.insertNode(e),d=d.cloneRange(),d.selectNode(e),d.collapse(!1),c.removeAllRanges(),c.addRange(d))):document.selection&&document.selection.createRange&&(document.selection.createRange().text="<br>")}else console.info("creating new section: ",b),m.createNewSection();else console.info("need to hide the toolboxes")}function f(b){b=b?b:a.event,h(m),(8===b.keyCode||46===b.keyCode)&&i(m)}if(this.src=null,this.sel=null,this.sec=null,this.settings=null,0===arguments.length)throw"Init error: we need the editor element!";1===arguments.length?(this.src=arguments[0],this.settings=k):2===arguments.length&&"object"==typeof arguments[1]&&(this.src=arguments[0],this.settings=d(k,arguments[1]));var m=this;this.src.classList.add("ied-article"),e(this.src,"contenteditable","true"),document.addEventListener("selectionchange",b),this.src.addEventListener("keydown",c),this.src.addEventListener("keyup",f),this.setup=function(a){"object"==typeof a&&(this.settings=d(this.settings,a))},this.createNewSection=function(){var a=document.createElement("section");a.className="col";var b=document.createElement("p");b.dataset.text=this.settings.lang.text,a.appendChild(b),this.sec.nextSibling?this.sec.parentNode.insertBefore(a,this.sec.nextSibling):this.sec.appendNode(a);var c,d;return c=document.createRange(),c.selectNodeContents(b),c.collapse(!0),d=window.getSelection(),d.removeAllRanges(),d.addRange(c),h(this),!1},this.showToolboxSelection=function(){return j(l.selection)},this.hideToolboxSelection=function(){return null!==l.selection.current?(l.selection.current.className="hidden",!0):!1}}}(window,document);