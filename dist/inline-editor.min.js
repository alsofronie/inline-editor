/*! Inline Editor - v0.1.0 -  * 2015-08-14
 * * https://github.com/alsofronie/inline-editor
 * Copyright (c) 2015 Alex Sofronie; * Licensed MIT */ 
!function(a,b,c){"use strict";function d(a,b){var c;for(c in b)a.hasOwnProperty(c)&&("object"==typeof b[c]?a[c]=d(a[c],b[c]):a[c]=b[c]);return a}function e(b,c){b=b||a.event,b.stopPropagation&&b.stopPropagation(),b.cancelBubble=!0,c===!0&&b.preventDefault()}var f={lang:{text:"Add your text here",title:"Add your title here"},toolboxes:{selection:["bold","italic","underline","strikethrough","|","h","p","|","align"],insert:["image","video","embed","section"],image:["normal","left","right","full"]}},g={selection:{current:null,name:"selection",id:"seltbx-pane",widgets:{bold:function(a){return a?void document.execCommand("bold",!1,!0):{icon:"bold"}},italic:function(a){return a?void document.execCommand("italic",!1,!0):{icon:"italic"}},underline:function(a){return a?void document.execCommand("underline",!1,!0):{icon:"underline"}},strikethrough:function(a){return a?void document.execCommand("strikeThrough",!1,!0):{icon:"strike"}},align:function(a){return a?void(h.hasClass(this.sel,"text-center")?(h.removeClass(this.sel,"text-center"),h.addClass(this.sel,"text-right")):h.hasClass(this.sel,"text-right")?(h.removeClass(this.sel,"text-right"),h.addClass(this.sel,"text-justify")):h.hasClass(this.sel,"text-justify")?h.removeClass(this.sel,"text-justify"):h.addClass(this.sel,"text-center")):{icon:"align"}},p:function(a){if(!a)return{icon:"para"};if(console.info("We need to change the current parent element to a paragraph"),!h.is(this.sel,"p")){var b=h.change(this.sel,"p",!1);h.select(b)}},h:function(a){if(!a)return{icon:"heading"};console.info("We need to change the current parent elment to a heading");var b="h1";h.is(this.sel,"h1")?b="h2":h.is(this.sel,"h2")?b="h3":h.is(this.sel,"h3")?b="h4":h.is(this.sel,"h4")?b="h5":h.is(this.sel,"h5")&&(b="h6");var c=h.change(this.sel,b,!0);h.select(c)}}}};a.InlineEditor=function(){function b(b){b=b?b:a.event,k.setSelection();var c=k.getSelection();c.isCollapsed?k.hideToolbox(g.selection):k.showToolbox(g.selection)}function i(b){if(b=b?b:a.event,k.setSelection(),13===b.keyCode)if(e(b,!0),b.shiftKey===!0){var c,d,f;window.getSelection?(c=window.getSelection(),c.getRangeAt&&c.rangeCount&&(d=c.getRangeAt(0),d.deleteContents(),d.collapse(!1),f=h.create("br"),d.insertNode(f),d=d.cloneRange(),d.selectNode(f),d.collapse(!1),c.removeAllRanges(),c.addRange(d))):document.selection&&document.selection.createRange&&(document.selection.createRange().text="<br>")}else console.info("creating new section: ",b),k.createNewSection();else console.info("need to hide the toolboxes")}function j(b){b=b?b:a.event,k.setSelection(),(8===b.keyCode||46===b.keyCode)&&k.verifyEmptyElement()}if(this.src=null,this.sel=null,this.sec=null,this.settings=null,0===arguments.length)throw"Init error: we need the editor element!";1===arguments.length?(this.src=arguments[0],this.settings=f):2===arguments.length&&"object"==typeof arguments[1]&&(this.src=arguments[0],this.settings=d(f,arguments[1])),this.src.classList.add("ied-article"),h.attr(this.src,"contenteditable","true");var k=this;document.addEventListener("selectionchange",b),this.src.addEventListener("keydown",i),this.src.addEventListener("keyup",j),this.setup=function(a){"object"==typeof a&&(this.settings=d(this.settings,a))},this.getSelection=function(){if(window.getSelection)return window.getSelection();var a=document.selection;return a&&"Control"!==a.type?a:null},this.createNewSection=function(){var a=document.createElement("section");a.className="col";var b=document.createElement("p");b.dataset.text=this.settings.lang.text,a.appendChild(b),this.sec.nextSibling?this.sec.parentNode.insertBefore(a,this.sec.nextSibling):this.sec.appendNode(a);var c,d;return c=document.createRange(),c.selectNodeContents(b),c.collapse(!0),d=window.getSelection(),d.removeAllRanges(),d.addRange(c),this.setSelection(),!1},this.showToolbox=function(a){if(null===a.current){var b=h.create("div");b.id=a.id;var d=h.create("ul");b.appendChild(d);var e=a.widgets,f=this.settings.toolboxes[a.name];for(var g in f){var i=f[g];if("|"!==i)if(e[i]){var j=e[i](!1),k=h.create("li"),l=h.create("button");if(l.dataset.act=i,j.icon!==c){var m=h.create("i","icon icon-"+j.icon);l.appendChild(m)}else j.text!==c&&l.appendChild(document.createTextNode(j.text));var n=this;l.addEventListener("click",function(a){console.info("event target is  now",a.srcElement);for(var b=a.srcElement||a.target;!h.is(b,"button");)b=b.parentNode;var c=b.dataset.act;e[c].call(n,!0)}),k.appendChild(l),d.appendChild(k)}else console.error("We do not know how to handle ",i);else{var o=h.create("li","divider");d.appendChild(o)}}document.body.appendChild(b),a.current=b}a.current.className="";var p,q,r,s;return p=this.getSelection(),q=p.getRangeAt(0).cloneRange(),r=q.getClientRects()[0],s={width:a.current.offsetWidth,height:a.current.offsetHeight},a.current.style.left=r.left-Math.floor(s.width/2)+Math.floor(r.width/2)+"px",a.current.style.top=r.top-3-s.height+"px",a.current},this.hideToolbox=function(a){return null!==a.current?(a.current.className="hidden",!0):!1},this.setSelection=function(){var a=this.getSelection(),b=null,c=null;for(b=a.getRangeAt(0).commonAncestorContainer,1!==b.nodeType&&(b=b.parentNode),c=b;c&&c.nodeName&&"section"!==c.nodeName.toLowerCase();)c=c.parentNode;this.sel=b,this.sec=c},this.verifyEmptyElement=function(){var a=this.sel;console.info("Verify empty on parent",a);var b=a;console.info("We need to check the node ",b),h.is(b,"figure")&&(b=b.lastChild);var c=b.innerHTML.trim().toLowerCase();console.info("html is ",c),("<br>"===c||"<br/>"===c||"<br />"===c||"&nbsp;"===c||""===c)&&(b.innerHTML=null,b.className="")}};var h={create:function(a,b){var d=document.createElement(a);return b!==c&&(d.className=b),d},attr:function(a,b,c){a.setAttribute(b,c)},is:function(a,b){return a&&null!==a&&a!==c?(b=b.toLowerCase(),b===a.tagName.toLowerCase()):!1},change:function(a,b,c){console.info("Changing to "+b+" node ",a);var d="";c&&(d=a.className);var e=h.create(b);for(e.className=d;a.firstChild;)e.appendChild(a.firstChild);return a.parentNode.insertBefore(e,a),a.parentNode.removeChild(a),e},select:function(a){var b=document.createRange();b.selectNodeContents(a);var c=window.getSelection();c.removeAllRanges(),c.addRange(b)},hasClass:function(a,b){return a.classList.contains(b)},addClass:function(a,b){a.classList.add(b)},removeClass:function(a,b){a.classList.remove(b)},toggleClass:function(a,b){a.classList.toggle(b)}}}(window,document);