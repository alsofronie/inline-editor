/*! Inline Editor - v0.1.0 -  * 2015-08-04
 * * https://github.com/alsofronie/inline-editor
 * Copyright (c) 2015 Alex Sofronie; * Licensed MIT */ 
!function(a,b,c,d){"use strict";function e(b,c){this.element=b,this.$e=a(b),this.settings=a.extend({},g,c),this._defaults=g,this._name=f,this.init()}var f="inline_editor",g={textEmpty:"Add your text here",titleEmpty:"Add your title here",toolbox:{selection:["bold","italic","underline","strikethrough","|","h","|","left","center","right","justify"]}};a.extend(e.prototype,{init:function(){this.prepare(),this.listenToEvents()},prepare:function(){this.$e.prop("contentEditable",!0)},listenToEvents:function(){var d=this;c.body.onclick=function(){c.getSelection().isCollapsed&&d.hideToolbox(d)},c.body.onkeyup=function(){d.hideToolbox(d)},this.$e.on("keypress",function(a){if(13!==a.keyCode)return!0;var e=d.getSelectionParentElement(),f=d.createNewSection(d.settings);e.nextSibling?e.parentNode.insertBefore(f.fragment,e.nextSibling):e.appendNode(f.fragment);var g,h;return g=c.createRange(),g.selectNodeContents(f.para),g.collapse(!0),h=b.getSelection(),h.removeAllRanges(),h.addRange(g),!1}),this.$e.off("selectstart").on("selectstart","section > *",function(){a(c).one("mouseup",function(){var a=this.getSelection();a.isCollapsed?d.hideToolbox(d):(d.currentSelection=a,d.setCurrents(a),d.getToolbox(d))})})},currentSelection:null,currentParentElement:null,currentSection:null,tbxSelection:null,hideToolbox:function(a){null!==a.tbxSelection&&(a.tbxSelection.className="hidden")},getToolbox:function(a){if(null===a.tbxSelection){var b=c.createElement("div");b.id="toolbox-panel";var e=c.createElement("ul");b.appendChild(e);for(var f in a.settings.toolbox.selection){var g=a.settings.toolbox.selection[f];if("|"!==g){if("function"==typeof a.toolboxWidgets[g]){var h=a.toolboxWidgets[g](),i=c.createElement("li"),j=c.createElement("button");if(j.dataset.act=g,j.onclick=function(b){a._stopPropagation(b);var c=b.srcElement||b.target,d=c.dataset.act;a.toolboxWidgets[d].call(a,!0)},h.wrap!==d&&(j.className="tbx tbx-"+h.wrap),h.text!==d&&j.appendChild(c.createTextNode(h.text)),h.icon!==d){var k=c.createElement("i");k.className="icon icon-"+h.icon,j.appendChild(k)}i.appendChild(j),e.appendChild(i)}}else{var l=c.createElement("li");l.className="divider",e.appendChild(l)}}c.body.appendChild(b),a.tbxSelection=b}a.tbxSelection.className="";var m=a.currentSelection.getRangeAt(0).cloneRange(),n=m.getClientRects()[0];console.info("Rectangle is now: ",n);var o={width:a.tbxSelection.offsetWidth,height:a.tbxSelection.offsetHeight};return a.tbxSelection.style.left=n.left-Math.floor(o.width/2)+Math.floor(n.width/2)+"px",a.tbxSelection.style.top=n.top-3-o.height+"px",a.tbxSelection},createNewSection:function(a){var b=c.createDocumentFragment(),d=c.createElement("section");d.className="col";var e=c.createElement("p");return e.className="p-nor",e.dataset.text=a.textEmpty,d.appendChild(e),b.appendChild(d),{fragment:b,para:e}},getSelectionParentElement:function(){var a,d=null;if(b.getSelection?(a=b.getSelection(),a.rangeCount&&(d=a.getRangeAt(0).commonAncestorContainer,1!==d.nodeType&&(d=d.parentNode))):(a=c.selection)&&"Control"!==a.type&&(d=a.createRange().parentElement()),null!==d)for(;"section"!==d.nodeName.toLowerCase();)d=d.parentNode;return d},setCurrents:function(){},_stopPropagation:function(a){a=a||b.event,a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0},toolboxWidgets:{bold:function(a){return a?void console.info("Run BOLD on ",a):{text:"B",wrap:"b"}},italic:function(a){return a?void console.info("Run ITALIC on ",a):{text:"I",wrap:"i"}},underline:function(a){return a?void console.info("Run UNDERLINE on ",a):{text:"U",wrap:"u"}},strikethrough:function(a){return a?void console.info("Run STRIKE on ",a):{text:"S",wrap:"s"}},left:function(a){return a?void console.info("Run LEFT on ",a):{text:"L"}},right:function(a){return a?void console.info("Run RIGHT on ",a):{text:"R"}},justify:function(a){return a?void console.info("Run justify on ",a):{text:"J"}},center:function(a){return a?void console.info("Run CENTER on ",a):{text:"C"}},h:function(a){return a?void console.info("Cycle through Headlines"):{text:"H1",wrap:"b"}}}}),a.fn[f]=function(b){return this.each(function(){a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new e(this,b))})}}(jQuery,window,document);